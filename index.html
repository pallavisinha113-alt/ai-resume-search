<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Resume Search (White Theme + Skill Dashboard Right)</title>

<!-- TFJS -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3/dist/universal-sentence-encoder.min.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --bg:#ffffff;
    --panel:#f4f4f4;
    --border:#d0d0d0;
    --text:#222;
    --muted:#666;
    --card:#ffffff;
    --shadow:0 4px 12px rgba(0,0,0,0.08);
    --radius:14px;
  }

  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto;
    margin:0;
    background:var(--bg);
    color:var(--text);
    padding:14px;
  }

  .app{ max-width:1100px; margin:auto; }

  header{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:var(--radius);
    padding:14px;
    box-shadow:var(--shadow);
    position:sticky; top:10px; z-index:10;
  }

  input{
    width:100%; padding:13px; border-radius:14px;
    border:1px solid var(--border); font-size:16px;
  }

  button{
    padding:12px 16px; border-radius:14px;
    background:#fafafa; border:1px solid var(--border);
    cursor:pointer; font-size:14px;
  }

  .chips{ display:flex; gap:8px; margin-top:10px; overflow-x:auto; }
  .pill{
    padding:8px 12px; border-radius:999px;
    background:#eee; border:1px solid #ccc;
    white-space:nowrap;
  }

  /* card styles */
  .results{ margin-top:10px; display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  @media(max-width:800px){ .results{ grid-template-columns:1fr; } }

  .card{
    background:#fff; border:1px solid var(--border);
    border-radius:14px; padding:14px; box-shadow:var(--shadow);
  }

  .badge{
    background:#e8f3ff; border:1px solid #bcdcff;
    padding:4px 10px; border-radius:999px; font-size:13px;
  }

  mark{
    background:#fff2a8; padding:0 3px; border-radius:3px;
  }

  /* RIGHT SIDE DASHBOARD */
  .results-and-dashboard {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    margin-top: 10px;
  }

  .results-area {
    flex: 3;
  }

  .dashboard-area {
    flex: 1;
    max-width: 280px;
    margin-left: 20px;
  }

  #skillDashboardBox {
    background: #fafafa;
    border: 1px solid var(--border);
    padding: 10px;
    border-radius: 14px;
    box-shadow: var(--shadow);
    width: 100%;
  }

  @media (max-width: 900px) {
    .results-and-dashboard {
      flex-direction: column;
    }
    .dashboard-area {
      max-width: 100%;
      margin-left: 0;
      margin-top: 20px;
    }
  }
</style>
</head>

<body>
<div class="app">

<header>
  <h2>AI Resume Search</h2>
  <p>Semantic + keyword boosting. Bench Skill Dashboard included.</p>

  <div style="display:grid; grid-template-columns:1fr auto; gap:10px;">
    <input id="searchBox" placeholder="Try: C++ embedded linux, Python ML..." disabled/>
    <button id="clearBtn">Clear</button>
  </div>

  <div class="chips">
    <button class="pill" data-q="C++ embedded linux RTOS">C++ embedded linux RTOS</button>
    <button class="pill" data-q="Java microservices spring boot">Java microservices</button>
    <button class="pill" data-q="5G LTE telecom RF">5G telecom</button>
    <button class="pill" data-q="Python machine learning MLOps">Python ML</button>
  </div>
</header>

<!-- MAIN LAYOUT: RESULTS LEFT, DASHBOARD RIGHT -->
<main>

  <div class="results-and-dashboard">

    <!-- LEFT SIDE: RESULTS -->
    <div class="results-area">
      <h3 style="margin-bottom:8px;">Results</h3>
      <div id="results" class="results"></div>
    </div>

    <!-- RIGHT SIDE: DASHBOARD -->
    <div class="dashboard-area">
      <div id="skillDashboardBox">
        <h4>Bench Skill Dashboard</h4>
        <p style="color:var(--muted); margin-top:-6px;">
          Frequency of skills in current results.
        </p>
        <canvas id="skillChart" height="180"></canvas>
      </div>
    </div>

  </div>

</main>

</div>

<script>
let model=null;
let resumeEmbeddings=null;
let resumeDB=[];

/* ---------- RESUME DATA WITH DEMO AVAILABILITY ---------- */
const seedResumes=[
  {
    name:"Arjun Mehta",
    resumeText:`Senior C++ & Embedded Engineer. Skills: C++, Embedded Linux, RTOS, CAN Bus.`,
    availability:"Available 40 hrs/week from Feb 10"
  },
  {
    name:"Sophia Rodriguez",
    resumeText:`Java Backend Developer. Skills: Java, Spring Boot, Microservices, Docker.`,
    availability:"Available 20 hrs/week from Feb 15"
  },
  {
    name:"Ethan Williams",
    resumeText:`Telecom Engineer. Skills: 5G, LTE, RF Systems, Protocol Stack.`,
    availability:"Available 30 hrs/week from Mar 1"
  },
  {
    name:"Mira Patel",
    resumeText:`Embedded Firmware Engineer. Skills: C, C++, FreeRTOS, BLE, STM32.`,
    availability:"Available 10 hrs/week now"
  },
  {
    name:"Daniel Chen",
    resumeText:`Python Developer. Skills: Python, TensorFlow, Cloud, APIs.`,
    availability:"Available 35 hrs/week from Feb 5"
  }
];

function loadResumes(){ return seedResumes; }

function tokenize(t){ return t.toLowerCase().split(/[^a-z0-9\+\#]+/).filter(Boolean); }

function cosineSimilarity(a,b){
  let dot=0,na=0,nb=0;
  for(let i=0;i<a.length;i++){
    dot+=a[i]*b[i]; na+=a[i]*a[i]; nb+=b[i]*b[i];
  }
  return dot/(Math.sqrt(na)*Math.sqrt(nb));
}

function keywordBoost(query,text){
  const tokens=tokenize(query);
  const hay=text.toLowerCase();
  let hit=0;
  tokens.forEach(t=>{ if(hay.includes(t)) hit++; });
  return hit/tokens.length;
}

function highlightSnippet(text,query){
  let sn=text.slice(0,220)+"...";
  tokenize(query).forEach(t=>{
    const re=new RegExp(t,"ig");
    sn=sn.replace(re,m=>`<mark>${m}</mark>`);
  });
  return sn;
}

/* ---------- SKILL DASHBOARD (RIGHT SIDE) ---------- */
let skillChart=null;

function buildSkillDashboard(results){
  let freq={};

  results.forEach(r=>{
    tokenize(r.resumeText).forEach(t=>{
      if(t.length>=3){ freq[t]=(freq[t]||0)+1; }
    });
  });

  const labels=Object.keys(freq).slice(0,15);
  const values=labels.map(l=>freq[l]);

  if(skillChart){ skillChart.destroy(); }

  const ctx=document.getElementById("skillChart").getContext("2d");
  skillChart=new Chart(ctx,{
    type:"bar",
    data:{
      labels:labels,
      datasets:[{
        data:values,
        backgroundColor:"#6aa6ff"
      }]
    },
    options:{
      responsive:true,
      plugins:{ legend:{display:false} },
      scales:{
        x:{ticks:{color:"#333", font:{size:10}}},
        y:{ticks:{color:"#333"}}
      }
    }
  });
}

async function embedQuery(q){
  const t=await model.embed([q]);
  const arr=await t.array();
  t.dispose();
  return arr[0];
}

function renderCards(list,query){
  const box=document.getElementById("results");
  box.innerHTML="";

  list.forEach(c=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div style="display:flex; justify-content:space-between;">
        <h3>${c.name}</h3>
        <div class="badge">${(c.score*100).toFixed(1)}%</div>
      </div>

      <div>${highlightSnippet(c.resumeText,query)}</div>

      <p style="font-size:13px; margin-top:6px;">
        <strong>Availability:</strong> ${c.availability}<br>
        Semantic: ${(c.sem*100).toFixed(1)}% â€¢ Skill-hit: ${(c.kw*100).toFixed(1)}%
      </p>
    `;
    box.appendChild(card);
  });
}

async function searchAndRender(q){
  q=q.trim();
  if(!q){ document.getElementById("results").innerHTML=""; return; }

  let qEmbed=null;
  if(model && resumeEmbeddings){
    qEmbed=await embedQuery(q);
  }

  const out=resumeDB.map((r,i)=>{
    const kw=keywordBoost(q,r.resumeText);
    let sem=0;
    if(qEmbed) sem=cosineSimilarity(qEmbed,resumeEmbeddings[i]);
    const score=0.6*sem+0.4*kw;
    return {...r,kw,sem,score};
  }).sort((a,b)=>b.score-a.score);

  renderCards(out,q);
  buildSkillDashboard(out);
}

async function init(){
  resumeDB=loadResumes();

  const s=document.getElementById("searchBox");
  const c=document.getElementById("clearBtn");

  try{
    model=await use.load();
    const texts=resumeDB.map(r=>r.resumeText);
    const emb=await model.embed(texts);
    resumeEmbeddings=await emb.array();
    emb.dispose();
  }catch(e){ console.log("Model load failed, fallback."); }

  s.disabled=false;
  s.addEventListener("input",()=>searchAndRender(s.value));
  c.addEventListener("click",()=>{
    s.value=""; document.getElementById("results").innerHTML="";
    buildSkillDashboard([]); 
  });

  document.querySelectorAll(".pill").forEach(p=>{
    p.addEventListener("click",()=>{
      s.value=p.dataset.q;
      searchAndRender(s.value);
    });
  });

  s.value="C++ embedded linux";
  searchAndRender(s.value);
}

init();
</script>

</body>
</html>
