<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>AI Resume Search (Syntronic Edition)</title>

<!-- TFJS -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<!-- USE -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3/dist/universal-sentence-encoder.min.js"></script>

<style>
  :root{
    --bg: #ffffff;
    --panel: #f4f4f4;
    --border: #d0d0d0;
    --text: #222;
    --muted: #555;
    --chip: #f2f2f2;
    --chipBorder: #ccc;
    --card: #ffffff;
    --shadow: 0 4px 12px rgba(0,0,0,0.08);
    --radius: 14px;
  }

  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    padding: 20px;
  }

  .app {
    max-width: 1250px;
    margin: 0 auto;
  }

  /* Logo + Title Layout */
  header {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    box-shadow: var(--shadow);
  }

  .header-flex {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .logo {
    height: 45px;
  }

  h1 { margin: 0; font-size: 24px; }
  .sub { margin: 5px 0 12px; color: var(--muted); }

  /* Search Row */
  .searchRow {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 10px;
    margin-top: 10px;
  }

  input[type="text"]{
    width: 100%;
    padding: 13px;
    font-size: 16px;
    border-radius: 12px;
    border: 1px solid var(--border);
  }

  button{
    border: 1px solid var(--border);
    background: #fafafa;
    padding: 13px 20px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
  }

  /* Pills */
  .chips {
    margin-top: 12px;
    display: flex;
    gap: 8px;
    overflow-x: auto;
  }

  .pill {
    border: 1px solid var(--chipBorder);
    background: var(--chip);
    padding: 8px 12px;
    border-radius: 999px;
    white-space: nowrap;
  }

  /* Two-column layout */
  .layout {
    display: grid;
    grid-template-columns: 3fr 1.2fr;
    gap: 18px;
    margin-top: 20px;
  }

  /* Results */
  .results {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }

  .card {
    background: var(--card);
    border: 1px solid var(--border);
    padding: 14px;
    border-radius: 14px;
    box-shadow: var(--shadow);
  }

  .cardTop {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
  }

  .badge {
    background: #e9f4ff;
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid #bcdcff;
    font-size: 13px;
    font-weight: bold;
  }

  /* Dashboard panel */
  .dashboardBox {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    background: #fafafa;
    box-shadow: var(--shadow);
    height: fit-content;
  }

  #skillChart {
    width: 100%;
    height: 200px;
  }

  mark {
    background: #fff3b0;
  }
</style>
</head>

<body>
<div class="app">

  <!-- HEADER WITH LOGO -->
  <header>
    <div class="header-flex">
      <img src="syntronic%20logo.png" class="logo" alt="Syntronic Logo">
      
      <div>
        <h1>AI Resume Search</h1>
        <p class="sub">Semantic + keyword boosting + Bench Skill Dashboard included.</p>
      </div>
    </div>

    <!-- SEARCH + BUTTONS -->
    <div class="searchRow">
      <input id="searchBox" type="text" placeholder="Search: Java Spring Boot Microservices..." />
      <button id="searchBtn">Search</button>
      <button id="clearBtn">Clear</button>
    </div>

    <!-- QUICK FILTERS -->
    <div class="chips">
      <button class="pill" data-q="Java Microservices">Java Microservices</button>
      <button class="pill" data-q="C++ Embedded">C++ Embedded</button>
      <button class="pill" data-q="C Developer">C Developer</button>
      <button class="pill" data-q="Python ML">Python ML</button>
    </div>
  </header>

  <!-- MAIN LAYOUT: RESULTS LEFT + DASHBOARD RIGHT -->
  <div class="layout">
    
    <!-- RESULTS -->
    <div>
      <h3>Results</h3>
      <div id="results" class="results"></div>
    </div>

    <!-- BENCH SKILL DASHBOARD -->
    <div class="dashboardBox">
      <h3>Bench Skill Dashboard</h3>
      <p style="font-size:13px;">Frequency of skills in current results.</p>
      <canvas id="skillChart"></canvas>
    </div>

  </div>

</div>

<script>
let model = null;
let resumeDB = [];
let resumeEmbeddings = null;

const seedResumes = [
  { name:"Sophia Rodriguez", resumeText:"Java Backend Developer. Skills: Java, Spring Boot, Microservices.", availability:"20 hrs/week" },
  { name:"Anita Joseph", resumeText:"Java Developer. Skills: Spring Boot, Microservices, Hibernate.", availability:"Full-time" },
  { name:"Priya Shah", resumeText:"Java Microservices Engineer. Skills: Java, Spring, Cloud.", availability:"30 hrs/week" },
  { name:"Sonia Varma", resumeText:"Full Stack Java Developer. Skills: Java, React, SQL, Microservices.", availability:"15 hrs/week" },
  { name:"Ravi Kumar", resumeText:"Java Developer. Skills: Java 11, Spring, REST APIs.", availability:"Full-time now" },

  { name:"Arjun Mehta", resumeText:"Senior C++ + Embedded Engineer. Skills: C++, Embedded Linux, RTOS.", availability:"40 hrs/week" },
  { name:"Mira Patel", resumeText:"Embedded Engineer. Skills: C, C++, FreeRTOS, BLE.", availability:"10 hrs/week" },

  { name:"Rahul Nair", resumeText:"C Developer. Skills: C, Drivers, Firmware, UART, SPI.", availability:"15 hrs/week" },
  { name:"John Lewis", resumeText:"C Developer. Skills: C, RTOS, Baremetal, I2C, SPI.", availability:"25 hrs/week" },

  { name:"Ethan Williams", resumeText:"5G Telecom Engineer. Skills: 5G, LTE, RF Systems.", availability:"30 hrs/week" }
];

// ------------------ UTILS ------------------

function tokenize(q){ return q.toLowerCase().split(/\s+/).filter(Boolean); }

function keywordBoostScore(query, text){
  const tokens = tokenize(query);
  const hay = text.toLowerCase();
  let hits = 0;
  tokens.forEach(t => { if(hay.includes(t)) hits++; });
  return hits / tokens.length;
}

function cosineSimilarity(a,b){
  let dot=0,na=0,nb=0;
  for(let i=0;i<a.length;i++){
    dot+=a[i]*b[i]; na+=a[i]*a[i]; nb+=b[i]*b[i];
  }
  return dot/(Math.sqrt(na)*Math.sqrt(nb));
}

function highlight(text,q){
  let out = text;
  tokenize(q).forEach(t=>{
    if(t.length<2) return;
    out = out.replace(new RegExp(t,"ig"),m=>`<mark>${m}</mark>`);
  });
  return out;
}

// -------------- RENDER RESULTS --------------
function renderResults(list, query){
  const results = document.getElementById("results");
  results.innerHTML = "";

  list.forEach(c=>{
    const card = document.createElement("div");
    card.className="card";

    card.innerHTML = `
      <div class="cardTop">
        <strong>${c.name}</strong>
        <span class="badge">${(c.score*100).toFixed(1)}%</span>
      </div>
      <div>${highlight(c.resumeText, query)}</div>
      <div style="margin-top:6px;font-size:13px;">
        <strong>Availability:</strong> ${c.availability}<br>
        Semantic: ${(c.sem*100).toFixed(1)}% â€¢ Skill: ${(c.kw*100).toFixed(1)}%
      </div>
    `;

    results.appendChild(card);
  });
}

// ----------------- SKILL DASHBOARD -----------------
let chart = null;

function updateSkillChart(list){
  const skillCounts = {};

  list.forEach(r=>{
    const words = tokenize(r.resumeText);
    words.forEach(w=>{
      if(!skillCounts[w]) skillCounts[w]=0;
      skillCounts[w]++;
    });
  });

  const labels = Object.keys(skillCounts).slice(0,6);
  const data = labels.map(l=>skillCounts[l]);

  const ctx = document.getElementById("skillChart");

  if(chart) chart.destroy();

  chart = new Chart(ctx,{
    type:"bar",
    data:{
      labels: labels,
      datasets:[{
        label:"Count",
        data:data,
        backgroundColor:"rgba(0,123,255,0.6)"
      }]
    },
    options:{ responsive:true }
  });
}

// ---------------- SEARCH -----------------
async function search(query){
  if(!query){
    document.getElementById("results").innerHTML="";
    return;
  }

  let qEmbed = null;
  if(model && resumeEmbeddings){
    qEmbed = await model.embed([query]).then(t=>{ let a=t.arraySync()[0]; t.dispose(); return a; });
  }

  const scored = resumeDB.map((r,i)=>{
    const kw = keywordBoostScore(query, r.resumeText);
    let sem = 0;
    if(qEmbed) sem = cosineSimilarity(qEmbed, resumeEmbeddings[i]);
    return { ...r, kw, sem, score:0.6*sem + 0.4*kw };
  });

  scored.sort((a,b)=>b.score-a.score);

  renderResults(scored, query);
  updateSkillChart(scored);
}

// ---------------- INIT -----------------
async function init(){
  resumeDB = seedResumes;

  try{
    model = await use.load();
    const emb = await model.embed(resumeDB.map(r=>r.resumeText));
    resumeEmbeddings = emb.arraySync();
    emb.dispose();
  }catch(err){
    console.log("Model load failed, fallback mode.", err);
  }

  document.getElementById("searchBtn").onclick = ()=>{
    search(document.getElementById("searchBox").value);
  };

  document.getElementById("clearBtn").onclick = ()=>{
    document.getElementById("searchBox").value="";
    document.getElementById("results").innerHTML="";
  };

  document.querySelectorAll(".pill").forEach(b=>{
    b.onclick = ()=>{ 
      document.getElementById("searchBox").value=b.dataset.q;
      search(b.dataset.q);
    };
  });
}

init();
</script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
