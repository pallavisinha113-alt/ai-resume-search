<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Resume Search (20-Resume Edition)</title>

<!-- TFJS -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<!-- USE -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3/dist/universal-sentence-encoder.min.js"></script>

<style>
  body {
    font-family: system-ui, Arial;
    background: #fafafa;
    margin: 0;
    padding: 20px;
  }
  .container {
    display: flex;
    gap: 20px;
    align-items: flex-start;
  }
  .left-panel {
    width: 70%;
  }
  .right-panel {
    width: 30%;
  }
  header {
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 15px;
  }
  input[type=text] {
    width: 100%;
    padding: 12px;
    font-size: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  .chips {
    margin-top: 10px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .pill {
    background: #eee;
    padding: 6px 10px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 13px;
  }
  .results {
    margin-top: 10px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  .card {
    background: #fff;
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  mark {
    background: yellow;
  }
  .badge {
    float: right;
    padding: 6px 10px;
    background: #def;
    border-radius: 20px;
    font-size: 12px;
  }
  canvas { width: 100% !important; height: 260px !important; }
</style>
</head>

<body>
<header>
  <h2>AI Resume Search</h2>
  <p>Semantic + keyword boosting + Bench Skill Dashboard.</p>
  <input id="searchBox" type="text" placeholder="Search: Java, C++, embedded linux, RTOS..." disabled>
  
  <div class="chips">
    <div class="pill" data-q="Java Spring Boot Microservices">Java Microservices</div>
    <div class="pill" data-q="C++ embedded linux RTOS">C++ Embedded</div>
    <div class="pill" data-q="C developer firmware">C Developer</div>
    <div class="pill" data-q="Python ML TensorFlow">Python ML</div>
  </div>
</header>

<div class="container">
  <div class="left-panel">
    <h3>Results</h3>
    <div id="results" class="results"></div>
  </div>

  <div class="right-panel">
    <h3>Bench Skill Dashboard</h3>
    <p style="font-size:12px;margin-top:-10px;">Frequency of skills in the current results.</p>
    <canvas id="skillChart"></canvas>
  </div>
</div>

<script>
let model = null;
let resumeDB = [];
let resumeEmbeddings = null;
let chart = null;

/* ------------------------------------------
   20 RESUMES (Java, C, C++, Embedded, Python)
------------------------------------------- */
const seedResumes = [
  { name:"Arjun Mehta", resumeText:"Senior C++ Embedded Engineer. Skills: C++, Embedded Linux, RTOS, CAN, Automotive ECUs.", availability:"40 hrs/week from Feb 10" },
  { name:"Sophia Rodriguez", resumeText:"Java Backend Developer. Skills: Java, Spring Boot, Microservices, Kafka, Docker.", availability:"20 hrs/week from Feb 15" },
  { name:"Ethan Williams", resumeText:"Telecom Engineer. Skills: 5G, LTE, RF, Protocol Stack, Optimization.", availability:"30 hrs/week from Mar 1" },
  { name:"Mira Patel", resumeText:"Embedded Firmware Developer. Skills: C, C++, FreeRTOS, BLE, STM32.", availability:"10 hrs/week now" },
  { name:"Daniel Chen", resumeText:"Python ML Engineer. Skills: Python, TensorFlow, Cloud, APIs.", availability:"35 hrs/week from Feb 5" },

  { name:"Ravi Kumar", resumeText:"Java Developer. Skills: Java 11, REST APIs, Spring Security, JPA.", availability:"Full-time now" },
  { name:"Jasmine Kaur", resumeText:"C Developer. Skills: C, firmware, UART, SPI, embedded drivers.", availability:"25 hrs/week from Feb 20" },
  { name:"Omar Siddiq", resumeText:"C++ Application Engineer. Skills: C++, STL, multithreading, Linux.", availability:"Full-time from Mar 10" },
  { name:"Priya Shah", resumeText:"Java Microservices Engineer. Skills: Java, Spring Cloud, Kubernetes.", availability:"30 hrs/week" },
  { name:"Leon Wu", resumeText:"Embedded Linux Engineer. Skills: C, C++, Yocto, device drivers.", availability:"20 hrs/week" },

  { name:"Kiran Bhat", resumeText:"C++ Automotive Engineer. Skills: AUTOSAR, C++, CAN, UDS.", availability:"40 hrs/week" },
  { name:"Sonia Varma", resumeText:"Full Stack Java Developer. Skills: Java, React, SQL, Microservices.", availability:"15 hrs/week" },
  { name:"Alex Raymond", resumeText:"Data Engineer. Skills: Python, Spark, AWS, ETL.", availability:"10 hrs/week" },
  { name:"Lina Gomez", resumeText:"QA Engineer. Skills: Manual testing, automation, Selenium, APIs.", availability:"Full-time from Feb 25" },
  { name:"Rahul Nair", resumeText:"C Developer. Skills: C, RTOS, BSP, embedded bootloader.", availability:"Full-time" },

  { name:"Meera Subramani", resumeText:"Cloud Engineer. Skills: Java, AWS, Lambda, CI/CD.", availability:"35 hrs/week" },
  { name:"Jack Morrison", resumeText:"C++ Robotics Engineer. Skills: ROS, C++, Sensors, SLAM.", availability:"25 hrs/week" },
  { name:"Anita Joseph", resumeText:"Java Developer. Skills: Spring Boot, Hibernate, Microservices.", availability:"Full-time" },
  { name:"Tom Nguyen", resumeText:"C Firmware Developer. Skills: C, HAL, SPI, I2C, FreeRTOS.", availability:"20 hrs/week" },
  { name:"Sara Kim", resumeText:"ML Engineer. Skills: Python, PyTorch, NLP, data modeling.", availability:"30 hrs/week" }
];

/* ---------------- Helper Functions ---------------- */

function tokenize(q) {
  return q.toLowerCase().split(/\s+/).filter(Boolean);
}

function cosineSimilarity(a,b){
  let dot=0,nA=0,nB=0;
  for(let i=0;i<a.length;i++){
    dot+=a[i]*b[i]; nA+=a[i]*a[i]; nB+=b[i]*b[i];
  }
  return dot / (Math.sqrt(nA)*Math.sqrt(nB));
}

function keywordBoostScore(query,text){
  const tokens = tokenize(query);
  const hay = text.toLowerCase();
  let hits = 0;
  tokens.forEach(t => { if(hay.includes(t)) hits++; });
  return hits / tokens.length;
}

function highlight(text, query){
  let s = text;
  tokenize(query).forEach(t=>{
    s = s.replace(new RegExp(t,"ig"), m=>`<mark>${m}</mark>`);
  });
  return s;
}

/* ---------------- Rendering ---------------- */

function updateSkillChart(resumes, query){
  const skills = {};
  const tokens = tokenize(query);

  resumes.forEach(r=>{
    const words = r.resumeText.toLowerCase().split(/[^a-zA-Z0-9\+]+/);
    tokens.forEach(tok=>{
      const count = words.filter(w=>w.includes(tok.toLowerCase())).length;
      if(count>0) skills[tok] = (skills[tok] || 0) + count;
    });
  });

  const labels = Object.keys(skills);
  const values = Object.values(skills);

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("skillChart"), {
    type: "bar",
    data: { labels, datasets:[{ label:"Count", data:values, backgroundColor:"#76a9ff" }] },
    options: { plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
  });
}

function renderCards(list, query){
  const div = document.getElementById("results");
  div.innerHTML = "";

  list.forEach(r=>{
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML = `
      <div class="badge">${(r.score*100).toFixed(1)}%</div>
      <h4>${r.name}</h4>
      <p>${highlight(r.resumeText, query)}</p>
      <p><strong>Availability:</strong> ${r.availability}</p>
      <p style="font-size:12px;color:#666;">Semantic: ${(r.sem*100).toFixed(1)}% â€¢ Skill-hit: ${(r.kw*100).toFixed(1)}%</p>
    `;
    div.appendChild(card);
  });
}

/* ---------------- Search Logic ---------------- */

async function searchAndRender(q){
  if(!q.trim()){
    document.getElementById("results").innerHTML="";
    return;
  }

  let qEmbed = null;
  if(model && resumeEmbeddings) qEmbed = await embedQuery(q);

  const scored = resumeDB.map((r,i)=>{
    const kw = keywordBoostScore(q, r.resumeText);
    let sem = 0;
    if(qEmbed) sem = cosineSimilarity(qEmbed, resumeEmbeddings[i]);
    return { ...r, kw, sem, score: 0.6*sem + 0.4*kw };
  });

  scored.sort((a,b)=>b.score-a.score);

  renderCards(scored, q);
  updateSkillChart(scored, q);
}

async function embedQuery(q){
  const t = await model.embed([q]);
  const arr = await t.array();
  t.dispose();
  return arr[0];
}

/* ---------------- Init ---------------- */

async function init(){
  resumeDB = seedResumes;

  try {
    model = await use.load();
    const emb = await model.embed(resumeDB.map(r=>r.resumeText));
    resumeEmbeddings = await emb.array();
    emb.dispose();
  } catch (e){
    console.log("Model failed, using keyword only.");
  }

  const searchBox = document.getElementById("searchBox");
  searchBox.disabled = false;
  searchBox.addEventListener("input", ()=>searchAndRender(searchBox.value));

  document.querySelectorAll(".pill").forEach(p=>{
    p.addEventListener("click", ()=>{
      searchBox.value = p.dataset.q;
      searchAndRender(searchBox.value);
    });
  });

  searchBox.value = "Java developer";
  searchAndRender(searchBox.value);
}

init();
</script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
