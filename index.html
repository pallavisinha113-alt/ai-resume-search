<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>AI Resume Search (White Theme + Availability)</title>

<!-- TFJS -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<!-- USE -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3/dist/universal-sentence-encoder.min.js"></script>

<style>
  :root{
    --bg: #ffffff;
    --panel: #f4f4f4;
    --panel2: #ececec;
    --border: #d0d0d0;
    --text: #222;
    --muted: #555;
    --chip: #f2f2f2;
    --chipBorder: #ccc;
    --card: #ffffff;
    --shadow: 0 4px 12px rgba(0,0,0,0.08);
    --radius: 14px;
  }

  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    padding: 14px;
  }

  .app {
    max-width: 980px;
    margin: 0 auto;
  }

  header {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px;
    box-shadow: var(--shadow);
    position: sticky;
    top: 10px;
    z-index: 10;
  }

  h1 { margin: 2px 0 6px; font-size: 20px; }
  .sub {
    margin: 0 0 12px;
    color: var(--muted);
    font-size: 13px;
  }

  .bar {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 10px;
  }

  input[type="text"]{
    width: 100%;
    padding: 13px 12px;
    font-size: 16px;
    border-radius: 14px;
    border: 1px solid var(--border);
    background: #ffffff;
    color: var(--text);
  }

  button{
    border: 1px solid var(--border);
    background: #fafafa;
    color: #222;
    border-radius: 14px;
    padding: 12px 12px;
    font-size: 14px;
    cursor: pointer;
  }

  .chips {
    margin-top: 12px;
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding-bottom: 4px;
  }

  .pill {
    border: 1px solid var(--chipBorder);
    background: var(--chip);
    padding: 9px 10px;
    border-radius: 999px;
    font-size: 13px;
    white-space: nowrap;
  }

  .results {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 14px;
    box-shadow: var(--shadow);
  }

  .cardTop {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: start;
    margin-bottom: 8px;
  }

  .name { margin: 0; font-size: 16px; }

  .badge {
    font-weight: 650;
    font-size: 12.5px;
    border: 1px solid #bcdcff;
    background: #e9f4ff;
    padding: 6px 10px;
    border-radius: 999px;
    min-width: 92px;
    text-align: center;
  }

  .snippet {
    font-size: 14px;
    color: #444;
    line-height: 1.45;
  }

  .meta {
    margin-top: 10px;
    font-size: 12.5px;
    color: #555;
  }

  mark {
    background: #fff3b0;
    border-radius: 4px;
    padding: 0 3px;
  }

  @media (min-width: 800px){
    .results { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>

<body>
<div class="app">
  <header>
    <h1>AI Resume Search</h1>
    <p class="sub">Semantic search + keyword boosting. No backend; all client-side.</p>

    <div class="bar">
      <input id="searchBox" type="text" placeholder="Try: C++ embedded linux, Java microservices..." disabled />
      <button id="clearBtn">Clear</button>
    </div>

    <div class="chips">
      <button class="pill" data-q="C++ embedded linux RTOS">C++ embedded linux RTOS</button>
      <button class="pill" data-q="Java spring boot microservices">Java microservices</button>
      <button class="pill" data-q="5G LTE telecom RF">5G telecom</button>
      <button class="pill" data-q="Python machine learning MLOps">Python ML</button>
    </div>
  </header>

  <main>
    <h3 style="margin: 16px 4px;">Results</h3>
    <div id="results" class="results"></div>
  </main>
</div>

<script>
let model = null;
let resumeDB = [];
let resumeEmbeddings = null;

// --------------------------------
// Resume DB + placeholder availability
// --------------------------------
const seedResumes = [
  {
    name: "Arjun Mehta",
    resumeText: `
      Senior C++ and Embedded Engineer, 8 years experience.
      Skills: C++, Embedded Linux, RTOS, CAN Bus, Automotive ECUs.
    `,
    availability: "TBD"
  },
  {
    name: "Sophia Rodriguez",
    resumeText: `
      Java Backend Developer, 6 years experience.
      Skills: Java, Spring Boot, APIs, Microservices, Docker.
    `,
    availability: "TBD"
  },
  {
    name: "Ethan Williams",
    resumeText: `
      Telecom Engineer specialized in 5G and LTE.
      Skills: RF Systems, 5G NR, LTE, Protocol Stack.
    `,
    availability: "TBD"
  },
  {
    name: "Mira Patel",
    resumeText: `
      Embedded Firmware Engineer with IoT background.
      Skills: C, C++, FreeRTOS, BLE, STM32.
    `,
    availability: "TBD"
  },
  {
    name: "Daniel Chen",
    resumeText: `
      Python Developer & ML Engineer.
      Skills: Python, TensorFlow, APIs, Cloud.
    `,
    availability: "TBD"
  }
];

function loadResumes() {
  return seedResumes;
}

function tokenize(q) {
  return q.toLowerCase().split(/\s+/).filter(Boolean);
}

function cosineSimilarity(a, b) {
  let dot = 0, normA = 0, normB = 0;
  for (let i = 0; i < a.length; i++){
    dot += a[i] * b[i];
    normA += a[i] * a[i];
    normB += b[i] * b[i];
  }
  return dot / (Math.sqrt(normA)*Math.sqrt(normB));
}

function keywordBoostScore(query, text){
  const tokens = tokenize(query);
  const hay = text.toLowerCase();
  let hits = 0;
  tokens.forEach(t => {
    if (hay.includes(t)) hits++;
  });
  return hits / tokens.length;
}

function highlightSnippet(text, query){
  const tokens = tokenize(query);
  let snip = text.trim();
  snip = snip.slice(0, 200)+"...";
  tokens.forEach(t=>{
    if(t.length<2) return;
    const re = new RegExp(t, "ig");
    snip = snip.replace(re, m=> `<mark>${m}</mark>`);
  });
  return snip;
}

async function embedQuery(q){
  const t = await model.embed([q]);
  const arr = await t.array();
  t.dispose();
  return arr[0];
}

function renderCards(list, query){
  const results = document.getElementById("results");
  results.innerHTML = "";

  list.forEach(c => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <div class="cardTop">
        <h3 class="name">${c.name}</h3>
        <div class="badge">${(c.score*100).toFixed(1)}%</div>
      </div>

      <div class="snippet">${highlightSnippet(c.resumeText, query)}</div>

      <div class="meta">
        <strong>Availability:</strong> ${c.availability}<br>
        Semantic: ${(c.sem*100).toFixed(1)}% â€¢ Skill-hit: ${(c.kw*100).toFixed(1)}%
      </div>
    `;

    results.appendChild(card);
  });
}

async function searchAndRender(qRaw){
  const q = qRaw.trim();
  if(!q){
    document.getElementById("results").innerHTML="";
    return;
  }

  const query = q;
  let qEmbed = null;

  if(model && resumeEmbeddings){
    qEmbed = await embedQuery(query);
  }

  const scored = resumeDB.map((r,i)=>{
    const kw = keywordBoostScore(query, r.resumeText);
    let sem = 0;
    if(qEmbed && resumeEmbeddings){
      sem = cosineSimilarity(qEmbed, resumeEmbeddings[i]);
    }
    const score = 0.6*sem + 0.4*kw;
    return {...r, kw, sem, score};
  });

  scored.sort((a,b)=> b.score - a.score);
  renderCards(scored, query);
}

async function init(){
  resumeDB = loadResumes();

  const searchBox = document.getElementById("searchBox");
  const clearBtn = document.getElementById("clearBtn");

  try {
    model = await use.load();
    const texts = resumeDB.map(r=>r.resumeText);
    const emb = await model.embed(texts);
    resumeEmbeddings = await emb.array();
    emb.dispose();
  } catch(e){
    console.log("Model load failed, fallback:", e);
    model = null;
  }

  searchBox.disabled = false;
  searchBox.addEventListener("input", ()=> searchAndRender(searchBox.value));
  clearBtn.addEventListener("click", ()=>{
    searchBox.value="";
    document.getElementById("results").innerHTML="";
  });

  document.querySelectorAll(".pill").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      searchBox.value = btn.dataset.q;
      searchAndRender(searchBox.value);
    });
  });

  searchBox.value = "C++ embedded linux";
  searchAndRender(searchBox.value);
}

init();
</script>
</body>
</html>
